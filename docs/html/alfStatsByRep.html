<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>ALFRESCO Statistics: Function Code</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/cosmo.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
padding-top: 50px;
padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar) */
.section h2 {
padding-top: 55px;
margin-top: -55px;
}
.section h3 {
padding-top: 55px;
margin-top: -55px;
}
/* don't use link color in navbar */
.dropdown-menu>li>a {
color: black;
}
/* some padding for disqus */
#disqus_thread {
margin-top: 45px;
}
p {
  text-align: justify;
}
img.centered {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; }
code > span.dt { color: #dfdfbf; }
code > span.dv { color: #dcdccc; }
code > span.bn { color: #dca3a3; }
code > span.fl { color: #c0bed1; }
code > span.ch { color: #dca3a3; }
code > span.st { color: #cc9393; }
code > span.co { color: #7f9f7f; }
code > span.ot { color: #efef8f; }
code > span.al { color: #ffcfaf; }
code > span.fu { color: #efef8f; }
code > span.er { color: #c3bf9f; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SNAP Data QA/QC</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Overview</a></li>

          <li class="dropdown">
            <a href="climate" class="dropdown-toggle" data-toggle="dropdown">Climate <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="AR4_AR5_extract.html">Downscaled GCMs</a></li>
              <li><a href="CRU_extract.html">Downscaled CRU 3.x</a></li>
              <li><a href="PRISM_extract.html">2-km PRISM</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">GCM organization</li>
              <li><a href="stats_setup.html">Regions: stats</a></li>
              <li><a href="samples_setup.html">Regions: densities</a></li>
              <li><a href="cities_setup.html">Cities: stats</a></li>
              <li class="dropdown-header">CRU organization</li>
              <li><a href="stats_setup_CRU.html">Regions: stats</a></li>
              <li><a href="samples_setup_CRU.html">Regions: densities</a></li>
              <li><a href="cities_setup_CRU.html">Cities: stats</a></li>
            </ul>

          <li class="dropdown">
            <a href="fire-&-veg" class="dropdown-toggle" data-toggle="dropdown">Fire & Veg <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="alfStatsByRep_Rmpi.html">ALFRESCO: Rmpi</a></li>
              <li><a href="alfStatsByRep.html">ALFRESCO: functions</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Organization</li>
              <li><a href="getAlfStatsAndDensities.html">ALFRESCO: stats and densities</a></li>
            </ul>

          <li class="dropdown">
            <a href="app-docs" class="dropdown-toggle" data-toggle="dropdown">App docs <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="aboutapp.html">About</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Help documents</li>
              <li><a href="help01_start.html">Getting started</a></li>
              <li><a href="help02_data.html">Working with data</a></li>
              <li><a href="help03_plotOptions.html">Graphical options</a></li>
              <li><a href="help04_updating.html">Updating settings</a></li>
              <li><a href="help05_01_graphTS.html">Graphing: time series</a></li>
              <li><a href="help05_02_graphScatter.html">Graphing: scatter plots</a></li>
              <li><a href="help05_03_graphHeat.html">Graphing: heat maps</a></li>
              <li><a href="help05_04_graphVar.html">Graphing: variability</a></li>
              <li><a href="help05_05_graphSpatial.html">Graphing: distributions</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Prep R code</li>
              <li><a href="qaqc_app_metadata.html">QA/QC App Metadata</a></li>
            </ul>

          <li class="dropdown">
            <a href="app-code" class="dropdown-toggle" data-toggle="dropdown">App code <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">App R code</li>
              <li><a href="appcode_global.html">global.R</a></li>
              <li><a href="appcode_ui.html">ui.R</a></li>
              <li><a href="appcode_server.html">server.R</a></li>
              <li><a href="appcode_about.html">about.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_sidebar.html">sidebar.R</a></li>
              <li><a href="appcode_main.html">main.R</a></li>
              <li><a href="appcode_serverHead.html">serverHead.R</a></li>
              <li><a href="appcode_app.html">app.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_io_sidebar.html">io_sidebar.R</a></li>
              <li><a href="appcode_io_main.html">io_main.R</a></li>
              <li><a href="appcode_reactives.html">reactives.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_plot_ts.html">plot_ts.R</a></li>
              <li><a href="appcode_plot_scatter.html">plot_scatter.R</a></li>
              <li><a href="appcode_plot_heatmap.html">plot_heatmap.R</a></li>
              <li><a href="appcode_plot_variability.html">plot_variability.R</a></li>
              <li><a href="appcode_plot_spatial.html">plot_spatial.R</a></li>
            </ul>

          <li><a href="http://leonawicz.github.io">All Projects</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/SNAPQAQC">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>

<div id="header">
<h1 class="title">ALFRESCO Statistics: Function Code</h1>
</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <code>alfStatsByRep.R</code> script uses extract fire and vegetation statistics from calibrated, finalized ALFRESCO run output over the full Alaska-Canada 1-km resolution ALFRESCO extent. Data are saved to <strong>R</strong> workspaces (.RData files) for analysis and graphing by subsequent <strong>R</strong> code.</p>
<div id="details" class="section level3">
<h3>Details</h3>
<p>This script is called by the wrapper script, <code>alfStatsByRep_Rpmi.R</code> as part of a non-interactive <strong>R</strong> SLURM job process using <code>Rmpi</code>. The script consists of functions, which are loaded onto each CPU core. The execution calls still originate from the parent <code>Rpmi</code> script on the head node.</p>
</div>
<div id="files-and-data" class="section level3">
<h3>Files and data</h3>
<p>The input files include 1-km Alaska-Canada extent data from ALFRESCO simulations as well as raster layer cell indices pertaining to various regional shapefile polygons. All input data are passed directly from the <code>alfStatsByRep_Rpmi.R</code> master <strong>R</strong> session running on the head node. <code>alfStatsByRep.R</code> performs data extractions on multiple CPU cores across multiple compute nodes based on the data passed down to each CPU. Each CPU on the compute nodes is responsible for processing data for a unique ALFRESCO simulation spatial time series replicate.</p>
<p><code>alfStatsByRep.R</code> passed some computed ALFRESCO output statistics back to <code>alfStatsByRep_Rpmi.R</code> on the head node to be combined, organized and written to intermediary files: * Burn area by region * Fire frequency by region * Vegetated area by region and vegetation class</p>
<p>Other data are written to files directly by <code>alfStatsByRep.R</code>, avoiding returning too much data to the head node. This consists of distributional information, in contrast to specific computed statistics, specifically semi-compact objects storing distributional properties of vegetation age by region, replicate, model and scenario in individual .RData workspace files.</p>
<p>Intermediate outputs are handled by additional <strong>R</strong> scripts.</p>
</div>
</div>
<div id="r-code" class="section level2">
<h2>R code</h2>
<div id="setup" class="section level3">
<h3>Setup</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
<span class="kw">library</span>(data.table)
<span class="kw">rasterOptions</span>(<span class="dt">chunksize =</span> <span class="dv">10</span>^<span class="dv">12</span>, <span class="dt">maxmemory =</span> <span class="dv">10</span>^<span class="dv">11</span>)</code></pre>
</div>
<div id="processing-functions" class="section level3">
<h3>Processing functions</h3>
<div id="getfirestats" class="section level4">
<h4>getFireStats</h4>
<pre class="sourceCode r"><code class="sourceCode r">getFireStats &lt;-<span class="st"> </span>function(i, mainDir, <span class="dt">years =</span> <span class="ot">NULL</span>, cells.list, shp.names.list, 
    n, ...) {
    rep.lab &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;_&quot;</span>, <span class="kw">c</span>(<span class="dv">0</span>:<span class="dv">199</span>), <span class="st">&quot;_&quot;</span>)[i]
    pat &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;expression&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">paste</span>(<span class="kw">bquote</span>(<span class="kw">expression</span>(<span class="st">&quot;^FireS.*.&quot;</span>, .(rep.lab), 
        <span class="st">&quot;.*.tif$&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
    filesF &lt;-<span class="st"> </span><span class="kw">list.files</span>(mainDir, <span class="dt">pattern =</span> pat, <span class="dt">full =</span> T)
    patV &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;expression&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">paste</span>(<span class="kw">bquote</span>(<span class="kw">expression</span>(<span class="st">&quot;^V.*.&quot;</span>, .(rep.lab), 
        <span class="st">&quot;.*.tif$&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
    filesV &lt;-<span class="st"> </span><span class="kw">list.files</span>(mainDir, <span class="dt">pattern =</span> patV, <span class="dt">full =</span> T)
    <span class="co"># files.years &lt;- as.numeric(substr(files,nchar(files)-7,nchar(files)-4))</span>
    files.years &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;FireScar_</span><span class="ch">\\</span><span class="st">d+_&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;.tif&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">basename</span>(filesF))))  <span class="co"># test line</span>
    ord &lt;-<span class="st"> </span><span class="kw">order</span>(files.years)  <span class="co"># test line</span>
    filesF &lt;-<span class="st"> </span>filesF[ord]  <span class="co"># test line</span>
    filesV &lt;-<span class="st"> </span>filesV[ord]  <span class="co"># test line</span>
    if (<span class="kw">is.numeric</span>(years)) 
        {
            p &lt;-<span class="st"> </span>files.years %in%<span class="st"> </span>years
            if (<span class="kw">any</span>(p)) {
                filesF &lt;-<span class="st"> </span>filesF[<span class="kw">which</span>(p)]
                filesV &lt;-<span class="st"> </span>filesV[<span class="kw">which</span>(p)]
                files.years &lt;-<span class="st"> </span>files.years[<span class="kw">which</span>(p)]
            }
        }  <span class="co"># test filesV addition</span>
    years &lt;-<span class="st"> </span><span class="kw">unique</span>(files.years)
    grp.names.vec &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">names</span>(cells.list), <span class="dt">times =</span> <span class="kw">sapply</span>(cells.list, length))
    loc.names.vec &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(cells.list, names)))
    
    getABFC &lt;-<span class="st"> </span>function(x, values, index) {
        <span class="co"># x &lt;- intersect(index, x)</span>
        if (<span class="kw">length</span>(x)) {
            AB &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(values[x] &gt;<span class="st"> </span><span class="dv">0</span>))
            FC &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(values[x]))
        } else AB &lt;-<span class="st"> </span>FC &lt;-<span class="st"> </span><span class="dv">0</span>
        <span class="kw">c</span>(AB, FC)
    }
    
    <span class="co"># fire size by vegetation class</span>
    fsByVeg &lt;-<span class="st"> </span>function(cells, i, v, v.fid, f.ind) {
        if (!<span class="kw">length</span>(cells)) 
            <span class="kw">return</span>(<span class="kw">data.frame</span>())
        dlist &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(i))
        ind &lt;-<span class="st"> </span><span class="kw">match</span>(cells, f.ind)
        if (<span class="kw">length</span>(ind) &lt;<span class="st"> </span><span class="kw">length</span>(f.ind)) 
            v[-ind] &lt;-<span class="st"> </span><span class="ot">NA</span>
        for (k in <span class="dv">1</span>:<span class="kw">length</span>(i)) {
            x &lt;-<span class="st"> </span>v
            x[x !=<span class="st"> </span>i[k]] &lt;-<span class="st"> </span><span class="ot">NA</span>
            x &lt;-<span class="st"> </span>v.fid[!<span class="kw">is.na</span>(x) &amp;<span class="st"> </span>!<span class="kw">is.na</span>(v.fid)]
            if (<span class="kw">length</span>(x)) {
                x &lt;-<span class="st"> </span><span class="kw">tapply</span>(x, x, length)
                ord &lt;-<span class="st"> </span><span class="kw">order</span>(<span class="kw">as.numeric</span>(x))
                dlist[[k]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Vegetation =</span> i[k], <span class="dt">FS =</span> <span class="kw">as.numeric</span>(x)[ord], 
                  <span class="dt">FID =</span> <span class="kw">as.numeric</span>(<span class="kw">names</span>(x))[ord])
            }
        }
        <span class="kw">as.data.frame</span>(<span class="kw">rbindlist</span>(dlist))
    }
    
    <span class="kw">print</span>(<span class="st">&quot;Beginning processing loop&quot;</span>)
    dlist &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(years))
    for (j in <span class="dv">1</span>:<span class="kw">length</span>(years)) {
        
        <span class="co"># fire size by vegetation class</span>
        v.fid &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesF[j], <span class="dt">band =</span> <span class="dv">2</span>))
        v.veg &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesV[j]))
        f.ind &lt;-<span class="st"> </span><span class="kw">which</span>(!<span class="kw">is.na</span>(v.fid))
        v.fid.rmNA &lt;-<span class="st"> </span>v.fid[f.ind]
        v.veg.rmNA &lt;-<span class="st"> </span>v.veg[f.ind]
        cells.rmNA &lt;-<span class="st"> </span><span class="kw">rapply</span>(cells.list, <span class="dt">f =</span> function(x, i) <span class="kw">intersect</span>(i, x), 
            <span class="dt">classes =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">how =</span> <span class="st">&quot;replace&quot;</span>, <span class="dt">i =</span> f.ind)
        <span class="co"># v.veg[v.veg==2 | v.veg==3] &lt;- 1 # 2 and 3 tree classes combine into class</span>
        <span class="co"># 1 to become &#39;forest&#39;, tundra types 4, 5, and 6 remain as before</span>
        vid &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">5</span>  <span class="co">#vid &lt;- sort(unique(v.veg[!is.na(v.veg) &amp; v.veg &gt; 0]))</span>
        if (!<span class="kw">all</span>(<span class="kw">is.na</span>(v.fid))) {
            <span class="kw">system.time</span>(dl &lt;-<span class="st"> </span><span class="kw">rapply</span>(cells.rmNA, <span class="dt">f =</span> fsByVeg, <span class="dt">classes =</span> <span class="st">&quot;integer&quot;</span>, 
                <span class="dt">how =</span> <span class="st">&quot;replace&quot;</span>, <span class="dt">i =</span> vid, <span class="dt">v =</span> v.veg.rmNA, <span class="dt">v.fid =</span> v.fid.rmNA, 
                <span class="dt">f.ind =</span> f.ind))
            n.fires &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">sapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(dl), function(x, l) <span class="kw">sapply</span>(l[[x]], 
                nrow), <span class="dt">l =</span> dl))
            d.j &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(<span class="kw">lapply</span>(dl, rbindlist))
            dlist[[j]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">LocGroup =</span> <span class="kw">rep</span>(grp.names.vec, <span class="dt">times =</span> n.fires), 
                <span class="dt">Location =</span> <span class="kw">rep</span>(loc.names.vec, <span class="dt">times =</span> n.fires), <span class="dt">VegID =</span> d.j$Vegetation, 
                <span class="dt">FID =</span> d.j$FID, <span class="dt">Val =</span> d.j$FS, <span class="dt">Year =</span> years[j], <span class="dt">Replicate =</span> i, 
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)  <span class="co"># end test lines</span>
        }
        
        <span class="co"># basic aggregate burn area and fire frequency</span>
        
        if (j ==<span class="st"> </span><span class="dv">1</span>) 
            m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="kw">length</span>(filesF), <span class="dv">2</span> *<span class="st"> </span>n)  <span class="co"># create matrix for multiple subdomains</span>
        v &lt;-<span class="st"> </span><span class="kw">rapply</span>(cells.rmNA, <span class="dt">f =</span> getABFC, <span class="dt">classes =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">how =</span> <span class="st">&quot;unlist&quot;</span>, 
            <span class="dt">values =</span> v.fid.rmNA, <span class="dt">index =</span> f.ind)
        m[j, <span class="dv">1</span>:(<span class="dv">2</span> *<span class="st"> </span>n)] &lt;-<span class="st"> </span>v
        
        <span class="kw">print</span>(years[j])
    }
    d.fs &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">rbindlist</span>(dlist))
    
    <span class="co"># d.fs$Vegetation &lt;- v.names[d.fs.veg$Vegetation]</span>
    varid &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;FC&quot;</span>), n)
    ab &lt;-<span class="st"> </span><span class="kw">as.integer</span>(m[, <span class="kw">which</span>(varid ==<span class="st"> &quot;AB&quot;</span>)])
    fc &lt;-<span class="st"> </span><span class="kw">as.integer</span>(m[, <span class="kw">which</span>(varid ==<span class="st"> &quot;FC&quot;</span>)])
    m &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">LocGroup =</span> <span class="kw">rep</span>(grp.names.vec, <span class="dt">each =</span> <span class="kw">length</span>(years)), <span class="dt">Location =</span> <span class="kw">rep</span>(loc.names.vec, 
        <span class="dt">each =</span> <span class="kw">length</span>(years)), <span class="dt">Var =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Burn Area&quot;</span>, <span class="st">&quot;Fire Count&quot;</span>), <span class="dt">each =</span> <span class="kw">length</span>(ab)), 
        <span class="dt">Val =</span> <span class="kw">c</span>(ab, fc), <span class="dt">Year =</span> years, <span class="dt">Replicate =</span> i, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
    <span class="kw">rownames</span>(m) &lt;-<span class="st"> </span><span class="ot">NULL</span>
    <span class="co"># print(paste(&#39;Returning area burned and fire frequency data frame.&#39;)) m</span>
    <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Returning list of (1) area burned and fire frequency data frame and (2) fire size by vegetation class data frame.&quot;</span>))
    <span class="kw">list</span>(m, d.fs)
}</code></pre>
</div>
<div id="getagevegstats" class="section level4">
<h4>getAgeVegStats</h4>
<pre class="sourceCode r"><code class="sourceCode r">getAgeVegStats &lt;-<span class="st"> </span>function(i, mainDir, denDir, <span class="dt">years =</span> <span class="ot">NULL</span>, cells.list, shp.names.list, 
    n, n.samples, ...) {
    rep.lab &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;_&quot;</span>, <span class="kw">c</span>(<span class="dv">0</span>:<span class="dv">199</span>), <span class="st">&quot;_&quot;</span>)[i]
    patA &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;expression&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">paste</span>(<span class="kw">bquote</span>(<span class="kw">expression</span>(<span class="st">&quot;^A.*.&quot;</span>, .(rep.lab), 
        <span class="st">&quot;.*.tif$&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
    filesA &lt;-<span class="st"> </span><span class="kw">list.files</span>(mainDir, <span class="dt">pattern =</span> patA, <span class="dt">full =</span> T)
    patV &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;expression&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">paste</span>(<span class="kw">bquote</span>(<span class="kw">expression</span>(<span class="st">&quot;^V.*.&quot;</span>, .(rep.lab), 
        <span class="st">&quot;.*.tif$&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
    filesV &lt;-<span class="st"> </span><span class="kw">list.files</span>(mainDir, <span class="dt">pattern =</span> patV, <span class="dt">full =</span> T)
    files.years &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">substr</span>(filesA, <span class="kw">nchar</span>(filesA) -<span class="st"> </span><span class="dv">7</span>, <span class="kw">nchar</span>(filesA) -<span class="st"> </span>
<span class="st">        </span><span class="dv">4</span>))
    if (<span class="kw">is.numeric</span>(years)) {
        p &lt;-<span class="st"> </span>files.years %in%<span class="st"> </span>years
        if (<span class="kw">any</span>(p)) {
            filesA &lt;-<span class="st"> </span>filesA[<span class="kw">which</span>(p)]
            filesV &lt;-<span class="st"> </span>filesV[<span class="kw">which</span>(p)]
            files.years &lt;-<span class="st"> </span>files.years[<span class="kw">which</span>(p)]
        }
    }
    years &lt;-<span class="st"> </span><span class="kw">unique</span>(files.years)
    r &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesA[<span class="dv">1</span>]))  <span class="co"># use as a template</span>
    data.ind &lt;-<span class="st"> </span><span class="kw">which</span>(!<span class="kw">is.na</span>(r))
    x &lt;-<span class="st"> </span><span class="kw">rapply</span>(cells.list, <span class="dt">f =</span> function(x) <span class="kw">lapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(filesA), function(x) 0L), 
        <span class="dt">classes =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">how =</span> <span class="st">&quot;replace&quot;</span>)
    
    <span class="co"># Density estimation</span>
    denFun &lt;-<span class="st"> </span>function(x, n, <span class="dt">adj =</span> <span class="fl">0.25</span>, <span class="dt">min.zero =</span> <span class="ot">TRUE</span>, <span class="dt">diversify =</span> <span class="ot">FALSE</span>) {
        x &lt;-<span class="st"> </span>x[!<span class="kw">is.na</span>(x)]
        lx &lt;-<span class="st"> </span><span class="kw">length</span>(x)
        if (diversify &amp;&amp;<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(x)) ==<span class="st"> </span><span class="dv">1</span>) 
            x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">max</span>(<span class="dv">10</span>, lx), <span class="dt">mean =</span> x[<span class="dv">1</span>])  <span class="co"># diversify constant values</span>
        if (lx ==<span class="st"> </span><span class="dv">1</span>) 
            x &lt;-<span class="st"> </span>x +<span class="st"> </span><span class="kw">c</span>(-<span class="dv">1</span>:<span class="dv">1</span>)  <span class="co">#single pixel of veg type, add and subtract one age year to make procedure possible</span>
        dif &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">range</span>(x))
        z &lt;-<span class="st"> </span><span class="kw">density</span>(x, <span class="dt">adjust =</span> adj, <span class="dt">n =</span> n, <span class="dt">from =</span> <span class="kw">min</span>(x) -<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, <span class="fl">0.05</span> *<span class="st"> </span>dif), 
            <span class="dt">to =</span> <span class="kw">max</span>(x) +<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, <span class="fl">0.05</span> *<span class="st"> </span>dif))
        if (min.zero &amp;&amp;<span class="st"> </span><span class="kw">any</span>(z$x &lt;<span class="st"> </span><span class="dv">0</span>)) 
            z &lt;-<span class="st"> </span><span class="kw">density</span>(x, <span class="dt">adjust =</span> adj, <span class="dt">n =</span> n, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(x) +<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, 
                <span class="fl">0.05</span> *<span class="st"> </span>dif))
        <span class="kw">as.numeric</span>(<span class="kw">c</span>(z$x, z$y))
    }
    
    <span class="kw">print</span>(<span class="st">&quot;Beginning processing loop&quot;</span>)
    dlist &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(years))
    for (j in <span class="dv">1</span>:<span class="kw">length</span>(years)) {
        a &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesA[j]))[data.ind]
        v &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesV[j]))[data.ind]
        <span class="co"># a[a&lt;0] &lt;- a[a&lt;0] + 2147483647 # temporary hack</span>
        dlist1 &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(x))
        for (l1 in <span class="dv">1</span>:<span class="kw">length</span>(x)) {
            dlist2 &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(x[[l1]]))
            for (l2 in <span class="dv">1</span>:<span class="kw">length</span>(x[[l1]])) {
                cells.tmp &lt;-<span class="st"> </span>cells.list[[l1]][[l2]]
                a.tmp &lt;-<span class="st"> </span>a[cells.tmp]
                v.tmp &lt;-<span class="st"> </span>v[cells.tmp]
                v.tmp.n &lt;-<span class="st"> </span><span class="kw">tapply</span>(cells.tmp, v.tmp, length)
                den.tmp &lt;-<span class="st"> </span><span class="kw">tapply</span>(a.tmp, v.tmp, denFun, <span class="dt">n =</span> n.samples)
                dlist2[[l2]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">LocGroup =</span> <span class="kw">names</span>(x)[l1], <span class="dt">Location =</span> <span class="kw">names</span>(x[[l1]])[l2], 
                  <span class="dt">VegID =</span> <span class="kw">rep</span>(<span class="kw">as.numeric</span>(<span class="kw">names</span>(den.tmp)), <span class="dt">each =</span> <span class="dv">2</span> *<span class="st"> </span>n.samples), 
                  <span class="dt">VegArea =</span> <span class="kw">rep</span>(v.tmp.n, <span class="dt">each =</span> <span class="dv">2</span> *<span class="st"> </span>n.samples), <span class="dt">Val =</span> <span class="kw">unlist</span>(den.tmp), 
                  <span class="dt">Year =</span> years[j], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
            }
            dlist1[[l1]] &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(dlist2)
        }
        dlist[[j]] &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(dlist1)
        <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Age and veg maps:&quot;</span>, years[j]))
    }
    
    x &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(dlist)
    x$Replicate &lt;-<span class="st"> </span>i
    veg.area &lt;-<span class="st"> </span>x[<span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(x), <span class="dt">by =</span> <span class="dv">2</span> *<span class="st"> </span>n.samples), -<span class="dv">5</span>]
    <span class="kw">names</span>(veg.area)[<span class="dv">4</span>] &lt;-<span class="st"> &quot;Val&quot;</span>
    veg.area$Var &lt;-<span class="st"> &quot;Vegetated Area&quot;</span>
    veg.area &lt;-<span class="st"> </span>veg.area[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>)]
    locs &lt;-<span class="st"> </span><span class="kw">unique</span>(x$Location)
    for (j in <span class="dv">1</span>:<span class="kw">length</span>(locs)) {
        obj.name.tmp &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;age__&quot;</span>, locs[j], <span class="st">&quot;__rep&quot;</span>, i)
        <span class="kw">assign</span>(obj.name.tmp, x[x$Location ==<span class="st"> </span>locs[j], -<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>)])
        <span class="kw">save</span>(<span class="dt">list =</span> <span class="kw">c</span>(<span class="st">&quot;locs&quot;</span>, obj.name.tmp), <span class="dt">file =</span> <span class="kw">paste0</span>(denDir, <span class="st">&quot;/&quot;</span>, obj.name.tmp, 
            <span class="st">&quot;.RData&quot;</span>))
        <span class="kw">print</span>(<span class="kw">paste</span>(obj.name.tmp, <span class="st">&quot;object of&quot;</span>, <span class="kw">length</span>(locs), <span class="st">&quot;saved.&quot;</span>))
        <span class="kw">rm</span>(<span class="dt">list =</span> obj.name.tmp)
        <span class="kw">gc</span>()
    }
    <span class="kw">rm</span>(x)
    <span class="kw">gc</span>()
    <span class="kw">print</span>(<span class="st">&quot;Returning veg class areas data frame for subregions.&quot;</span>)
    veg.area
}</code></pre>
</div>
<div id="getalfstats" class="section level4">
<h4>getAlfStats</h4>
<p>This function is not currently in use.</p>
<pre class="sourceCode r"><code class="sourceCode r">getAlfStats &lt;-<span class="st"> </span>function(i, mainDir, denDir, <span class="dt">years =</span> <span class="ot">NULL</span>, cells.list, shp.names.list, 
    n, n.samples, <span class="dt">replace.deciduous =</span> <span class="ot">FALSE</span>, ...) {
    rep.lab &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;_&quot;</span>, <span class="kw">c</span>(<span class="dv">0</span>:<span class="dv">199</span>), <span class="st">&quot;_&quot;</span>)[i]
    patF &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;expression&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">paste</span>(<span class="kw">bquote</span>(<span class="kw">expression</span>(<span class="st">&quot;^FireS.*.&quot;</span>, .(rep.lab), 
        <span class="st">&quot;.*.tif$&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
    filesF &lt;-<span class="st"> </span><span class="kw">list.files</span>(mainDir, <span class="dt">pattern =</span> patF, <span class="dt">full =</span> T)
    patA &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;expression&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">paste</span>(<span class="kw">bquote</span>(<span class="kw">expression</span>(<span class="st">&quot;^A.*.&quot;</span>, .(rep.lab), 
        <span class="st">&quot;.*.tif$&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
    filesA &lt;-<span class="st"> </span><span class="kw">list.files</span>(mainDir, <span class="dt">pattern =</span> patA, <span class="dt">full =</span> T)
    patV &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;expression&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">paste</span>(<span class="kw">bquote</span>(<span class="kw">expression</span>(<span class="st">&quot;^V.*.&quot;</span>, .(rep.lab), 
        <span class="st">&quot;.*.tif$&quot;</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
    filesV &lt;-<span class="st"> </span><span class="kw">list.files</span>(mainDir, <span class="dt">pattern =</span> patV, <span class="dt">full =</span> T)
    files.years &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">substr</span>(filesA, <span class="kw">nchar</span>(filesA) -<span class="st"> </span><span class="dv">7</span>, <span class="kw">nchar</span>(filesA) -<span class="st"> </span>
<span class="st">        </span><span class="dv">4</span>))
    if (<span class="kw">is.numeric</span>(years)) {
        p &lt;-<span class="st"> </span>files.years %in%<span class="st"> </span>years
        if (<span class="kw">any</span>(p)) {
            filesF &lt;-<span class="st"> </span>filesF[p]
            filesA &lt;-<span class="st"> </span>filesA[p]
            filesV &lt;-<span class="st"> </span>filesV[p]
            files.years &lt;-<span class="st"> </span>files.years[p]
        }
    }
    years &lt;-<span class="st"> </span><span class="kw">unique</span>(files.years)
    <span class="kw">print</span>(<span class="st">&quot;Vectors of annual files obtained for fire, age, and veg.&quot;</span>)
    grp.names.vec &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">names</span>(cells.list), <span class="dt">times =</span> <span class="kw">sapply</span>(cells.list, length))
    loc.names.vec &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(cells.list, names)))
    f.var &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;FC&quot;</span>), n)
    x &lt;-<span class="st"> </span><span class="kw">rapply</span>(cells.list, <span class="dt">f =</span> function(x) <span class="kw">lapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(filesA), function(x) 0L), 
        <span class="dt">classes =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">how =</span> <span class="st">&quot;replace&quot;</span>)
    <span class="co"># Area burned and fire count function</span>
    getABFC &lt;-<span class="st"> </span>function(x, values, index) {
        x &lt;-<span class="st"> </span><span class="kw">intersect</span>(index, x)
        if (<span class="kw">length</span>(x)) {
            AB &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(values[x] &gt;<span class="st"> </span><span class="dv">0</span>))
            FC &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(values[x]))
        } else AB &lt;-<span class="st"> </span>FC &lt;-<span class="st"> </span><span class="dv">0</span>
        <span class="kw">c</span>(AB, FC)
    }
    <span class="co"># Density estimation function</span>
    denFun &lt;-<span class="st"> </span>function(x, n, <span class="dt">adj =</span> <span class="fl">0.25</span>, <span class="dt">min.zero =</span> <span class="ot">TRUE</span>, <span class="dt">diversify =</span> <span class="ot">FALSE</span>) {
        x &lt;-<span class="st"> </span>x[!<span class="kw">is.na</span>(x)]
        lx &lt;-<span class="st"> </span><span class="kw">length</span>(x)
        if (diversify &amp;&amp;<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(x)) ==<span class="st"> </span><span class="dv">1</span>) 
            x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">max</span>(<span class="dv">10</span>, lx), <span class="dt">mean =</span> x[<span class="dv">1</span>])  <span class="co"># diversify constant values</span>
        if (lx ==<span class="st"> </span><span class="dv">1</span>) 
            x &lt;-<span class="st"> </span>x +<span class="st"> </span><span class="kw">c</span>(-<span class="dv">1</span>:<span class="dv">1</span>)  <span class="co">#single pixel of veg type, add and subtract one age year to make procedure possible</span>
        dif &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">range</span>(x))
        z &lt;-<span class="st"> </span><span class="kw">density</span>(x, <span class="dt">adjust =</span> adj, <span class="dt">n =</span> n, <span class="dt">from =</span> <span class="kw">min</span>(x) -<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, <span class="fl">0.05</span> *<span class="st"> </span>dif), 
            <span class="dt">to =</span> <span class="kw">max</span>(x) +<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, <span class="fl">0.05</span> *<span class="st"> </span>dif))
        if (min.zero &amp;&amp;<span class="st"> </span><span class="kw">any</span>(z$x &lt;<span class="st"> </span><span class="dv">0</span>)) 
            z &lt;-<span class="st"> </span><span class="kw">density</span>(x, <span class="dt">adjust =</span> adj, <span class="dt">n =</span> n, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(x) +<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, 
                <span class="fl">0.05</span> *<span class="st"> </span>dif))
        <span class="kw">as.numeric</span>(<span class="kw">c</span>(z$x, z$y))
    }
    <span class="kw">print</span>(<span class="st">&quot;Support functions defined and setup completed. Beginning annual processing...&quot;</span>)
    for (j in <span class="dv">1</span>:<span class="kw">length</span>(years)) {
        ff &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesF[j], <span class="dt">band =</span> <span class="dv">2</span>))
        f.ind &lt;-<span class="st"> </span><span class="kw">which</span>(!<span class="kw">is.na</span>(ff))
        ff &lt;-<span class="st"> </span><span class="kw">rapply</span>(cells.list, <span class="dt">f =</span> getABFC, <span class="dt">classes =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">how =</span> <span class="st">&quot;unlist&quot;</span>, 
            <span class="dt">values =</span> ff, <span class="dt">index =</span> f.ind)
        if (j ==<span class="st"> </span><span class="dv">1</span>) {
            fire &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="kw">length</span>(filesF), <span class="dv">2</span> *<span class="st"> </span>n)  <span class="co"># create an area burned and fire count matrix for multiple subdomains</span>
            a &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesA[<span class="dv">1</span>]))  <span class="co"># use as a template</span>
            a.ind &lt;-<span class="st"> </span><span class="kw">which</span>(!<span class="kw">is.na</span>(a))
            a &lt;-<span class="st"> </span>a[a.ind]
        } else {
            a &lt;-<span class="st"> </span>a +<span class="st"> </span><span class="dv">1</span>
            af.ind &lt;-<span class="st"> </span><span class="kw">intersect</span>(a.ind, f.ind)
            if (<span class="kw">length</span>(af.ind)) 
                a[af.ind] &lt;-<span class="st"> </span><span class="dv">0</span>
        }
        fire[j, <span class="dv">1</span>:(<span class="dv">2</span> *<span class="st"> </span>n)] &lt;-<span class="st"> </span>ff
        v &lt;-<span class="st"> </span><span class="kw">getValues</span>(<span class="kw">raster</span>(filesV[j]))[a.ind]
        for (l1 in <span class="dv">1</span>:<span class="kw">length</span>(x)) {
            for (l2 in <span class="dv">1</span>:<span class="kw">length</span>(x[[l1]])) {
                cells.tmp &lt;-<span class="st"> </span>cells.list[[l1]][[l2]]
                a.tmp &lt;-<span class="st"> </span>a[cells.tmp]
                v.tmp &lt;-<span class="st"> </span>v[cells.tmp]
                v.tmp.n &lt;-<span class="st"> </span><span class="kw">tapply</span>(cells.tmp, v.tmp, length)
                den.tmp &lt;-<span class="st"> </span><span class="kw">tapply</span>(a.tmp, v.tmp, denFun, <span class="dt">n =</span> n.samples)
                x[[l1]][[l2]][[j]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">LocGroup =</span> <span class="kw">names</span>(x)[l1], <span class="dt">Location =</span> <span class="kw">names</span>(x[[l1]])[l2], 
                  <span class="dt">VegID =</span> <span class="kw">rep</span>(<span class="kw">as.numeric</span>(<span class="kw">names</span>(den.tmp)), <span class="dt">each =</span> <span class="dv">2</span> *<span class="st"> </span>n.samples), 
                  <span class="dt">VegArea =</span> <span class="kw">rep</span>(v.tmp.n, <span class="dt">each =</span> <span class="dv">2</span> *<span class="st"> </span>n.samples), <span class="dt">Val =</span> <span class="kw">unlist</span>(den.tmp), 
                  <span class="dt">Year =</span> years[j], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
            }
        }
        <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Fire, age and vegetation processed:&quot;</span>, years[j]))
    }
    for (l1 in <span class="dv">1</span>:<span class="kw">length</span>(x)) for (l2 in <span class="dv">1</span>:<span class="kw">length</span>(x[[l1]])) x[[l1]][[l2]] &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, 
        x[[l1]][[l2]])
    x &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(x, do.call, <span class="dt">what =</span> rbind))
    x$Replicate &lt;-<span class="st"> </span>i
    veg.area &lt;-<span class="st"> </span>x[<span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(x), <span class="dt">by =</span> <span class="dv">2</span> *<span class="st"> </span>n.samples), -<span class="dv">5</span>]
    <span class="kw">names</span>(veg.area)[<span class="dv">4</span>] &lt;-<span class="st"> &quot;Val&quot;</span>
    veg.area$Var &lt;-<span class="st"> &quot;Vegetated Area&quot;</span>
    veg.area &lt;-<span class="st"> </span>veg.area[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>)]
    <span class="kw">rownames</span>(veg.area) &lt;-<span class="st"> </span><span class="ot">NULL</span>
    <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Veg class areas data frame compiled. Writing age density data frames to R workspaces...&quot;</span>))
    locs &lt;-<span class="st"> </span><span class="kw">unique</span>(x$Location)
    for (j in <span class="dv">1</span>:<span class="kw">length</span>(locs)) {
        obj.name.tmp &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;veg.age.loc&quot;</span>, j, <span class="st">&quot;.rep&quot;</span>, i)
        <span class="kw">assign</span>(obj.name.tmp, x[x$Location ==<span class="st"> </span>locs[j], -<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>)])
        <span class="kw">save</span>(<span class="dt">list =</span> <span class="kw">c</span>(<span class="st">&quot;locs&quot;</span>, obj.name.tmp), <span class="dt">file =</span> <span class="kw">paste0</span>(denDir, <span class="st">&quot;/&quot;</span>, obj.name.tmp, 
            <span class="st">&quot;.RData&quot;</span>))
        <span class="kw">print</span>(<span class="kw">paste</span>(obj.name.tmp, <span class="st">&quot;object of&quot;</span>, <span class="kw">length</span>(locs), <span class="st">&quot;saved.&quot;</span>))
        <span class="kw">rm</span>(<span class="dt">list =</span> obj.name.tmp)
        <span class="kw">gc</span>()
    }
    <span class="kw">rm</span>(x)
    <span class="kw">gc</span>()
    <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Age densities saved for all locations. Compiling area burned and fire frequency data frame...&quot;</span>))
    ab &lt;-<span class="st"> </span><span class="kw">as.integer</span>(fire[, <span class="kw">which</span>(f.var ==<span class="st"> &quot;AB&quot;</span>)])
    fc &lt;-<span class="st"> </span><span class="kw">as.integer</span>(fire[, <span class="kw">which</span>(f.var ==<span class="st"> &quot;FC&quot;</span>)])
    fire &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">LocGroup =</span> <span class="kw">rep</span>(grp.names.vec, <span class="dt">each =</span> <span class="kw">length</span>(years)), 
        <span class="dt">Location =</span> <span class="kw">rep</span>(loc.names.vec, <span class="dt">each =</span> <span class="kw">length</span>(years)), <span class="dt">Var =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Burn Area&quot;</span>, 
            <span class="st">&quot;Fire Count&quot;</span>), <span class="dt">each =</span> <span class="kw">length</span>(ab)), <span class="dt">Val =</span> <span class="kw">c</span>(ab, fc), <span class="dt">Year =</span> years, 
        <span class="dt">Replicate =</span> i, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
    <span class="kw">rownames</span>(fire) &lt;-<span class="st"> </span><span class="ot">NULL</span>
    <span class="kw">print</span>(<span class="st">&quot;Returning list of (1) area burned and fire frequency data frame and (2) veg class areas data frame for all regions.&quot;</span>)
    <span class="kw">list</span>(<span class="dt">fire =</span> fire, <span class="dt">veg.area =</span> veg.area)
}</code></pre>
</div>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
