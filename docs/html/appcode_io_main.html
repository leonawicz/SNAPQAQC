<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title></title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
padding-top: 50px;
padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar) */
.section h2 {
padding-top: 55px;
margin-top: -55px;
}
.section h3 {
padding-top: 55px;
margin-top: -55px;
}
/* don't use link color in navbar */
.dropdown-menu>li>a {
color: black;
}
/* some padding for disqus */
#disqus_thread {
margin-top: 45px;
}
p {
  text-align: justify;
}
img.centered {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; }
code > span.dt { color: #dfdfbf; }
code > span.dv { color: #dcdccc; }
code > span.bn { color: #dca3a3; }
code > span.fl { color: #c0bed1; }
code > span.ch { color: #dca3a3; }
code > span.st { color: #cc9393; }
code > span.co { color: #7f9f7f; }
code > span.ot { color: #efef8f; }
code > span.al { color: #ffcfaf; }
code > span.fu { color: #efef8f; }
code > span.er { color: #c3bf9f; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SNAP Data QA/QC</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Overview</a></li>

          <li class="dropdown">
            <a href="climate" class="dropdown-toggle" data-toggle="dropdown">Climate <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="AR4_AR5_extract.html">Downscaled GCMs</a></li>
              <li><a href="CRU_extract.html">Downscaled CRU 3.x</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">GCM organization</li>
              <li><a href="stats_setup.html">Regions: stats</a></li>
              <li><a href="samples_setup.html">Regions: densities</a></li>
              <li><a href="cities_setup.html">Cities: stats</a></li>
              <li class="dropdown-header">CRU organization</li>
              <li><a href="stats_setup_CRU.html">Regions: stats</a></li>
              <li><a href="samples_setup_CRU.html">Regions: densities</a></li>
              <li><a href="cities_setup_CRU.html">Cities: stats</a></li>
            </ul>

          <li class="dropdown">
            <a href="fire-&-veg" class="dropdown-toggle" data-toggle="dropdown">Fire & Veg <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="alfStatsByRep_Rmpi.html">ALFRESCO: Rmpi</a></li>
              <li><a href="alfStatsByRep.html">ALFRESCO: functions</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Organization</li>
              <li><a href="getAlfStatsAndDensities.html">ALFRESCO: stats and densities</a></li>
            </ul>

          <li class="dropdown">
            <a href="app-docs" class="dropdown-toggle" data-toggle="dropdown">App docs <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="aboutapp.html">About</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Help documents</li>
              <li><a href="help01_start.html">Getting started</a></li>
              <li><a href="help02_data.html">Working with data</a></li>
              <li><a href="help03_plotOptions.html">Graphical options</a></li>
              <li><a href="help04_updating.html">Updating settings</a></li>
              <li><a href="help05_01_graphTS.html">Graphing: time series</a></li>
              <li><a href="help05_02_graphScatter.html">Graphing: scatter plots</a></li>
              <li><a href="help05_03_graphHeat.html">Graphing: heat maps</a></li>
              <li><a href="help05_04_graphVar.html">Graphing: variability</a></li>
              <li><a href="help05_05_graphSpatial.html">Graphing: distributions</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Prep R code</li>
              <li><a href="qaqc_app_metadata.html">QA/QC App Metadata</a></li>
            </ul>

          <li class="dropdown">
            <a href="app-code" class="dropdown-toggle" data-toggle="dropdown">App code <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">App R code</li>
              <li><a href="appcode_global.html">global.R</a></li>
              <li><a href="appcode_ui.html">ui.R</a></li>
              <li><a href="appcode_server.html">server.R</a></li>
              <li><a href="appcode_about.html">about.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_sidebar.html">sidebar.R</a></li>
              <li><a href="appcode_main.html">main.R</a></li>
              <li><a href="appcode_serverHead.html">serverHead.R</a></li>
              <li><a href="appcode_app.html">app.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_io_sidebar.html">io_sidebar.R</a></li>
              <li><a href="appcode_io_main.html">io_main.R</a></li>
              <li><a href="appcode_reactives.html">reactives.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_plot_ts.html">plot_ts.R</a></li>
              <li><a href="appcode_plot_scatter.html">plot_scatter.R</a></li>
              <li><a href="appcode_plot_heatmap.html">plot_heatmap.R</a></li>
              <li><a href="appcode_plot_variability.html">plot_variability.R</a></li>
              <li><a href="appcode_plot_spatial.html">plot_spatial.R</a></li>
            </ul>

          <li><a href="http://leonawicz.github.io">All Projects</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/SNAPQAQC">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>



<div id="section" class="section level2">
<h2></h2>
</div>
<div id="section-1" class="section level2">
<h2></h2>
</div>
<div id="snap-data-qaqc-shiny-app-r-code" class="section level2">
<h2>SNAP data QA/QC Shiny app R code</h2>
<p><code>io_main.R</code> is a server-side <strong>R</strong> script sourced by <code>app.R</code>, which is in turn sourced by <code>server.R</code>. It contains a number of reactive outputs rendered in the browser, specifically outputs which are sent to the main panel area of the app.</p>
<div id="io_main.r" class="section level3">
<h3>io_main.R</h3>
<div id="plot-specific-sub-titling" class="section level4">
<h4>Plot-specific sub-titling</h4>
<p>These outputs are text which appear below a plot output and are not part of the plot itself. They are used to draw attention to which variables selected by the user are pooled in a plot.</p>
<p>For example, the data informing a time series may contain multiple years, months, locations, and climate models. If years are along the x-axis and the user has elected to color points or lines in the plot by locations and facet by month, this still leaves climate models pooled together. As a result, multiple points or lines of the same color can be displayed across the same x-axis values repeatedly. These text displays below the plot simply help to remind the user what they have chosen to display.</p>
<p>Due to the complexity of the app and the myriad ways in which variables can be selected, combined, aggregated, or broken apart, it is difficult to make the text outputs perfectly “smart”, and not worth the effort compared to more important app developments. However, they work decently enough, and it is because of their limitations that they appear below a plot rather than in the plot itself.</p>
<pre class="sourceCode r"><code class="sourceCode r">output$tsTextSub &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">twoBtnNullOrZero_ts</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(<span class="kw">pooledVarsCaption</span>(<span class="dt">pv =</span> <span class="kw">pooled.var</span>(), <span class="dt">permit =</span> <span class="kw">permitPlot</span>(), <span class="dt">ingrp =</span> input$group))
})

output$spTextSub &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">twoBtnNullOrZero_sc</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(<span class="kw">pooledVarsCaption</span>(<span class="dt">pv =</span> <span class="kw">pooled.var2</span>(), <span class="dt">permit =</span> <span class="kw">permitPlot</span>(), <span class="dt">ingrp =</span> input$group2))
})

output$hmTextSub &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">twoBtnNullOrZero_hm</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(<span class="kw">pooledVarsCaption</span>(<span class="dt">pv =</span> <span class="kw">pooledVarHeatmap</span>(), <span class="dt">permit =</span> <span class="kw">permitPlot</span>()))
})

output$varTextSub &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">twoBtnNullOrZero_vr</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(<span class="kw">pooledVarsCaption</span>(<span class="dt">pv =</span> <span class="kw">pooled.var3</span>(), <span class="dt">permit =</span> <span class="kw">permitPlot</span>(), <span class="dt">ingrp =</span> input$group3))
})

output$spatialTextSub &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">twoBtnNullOrZero_sp</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(<span class="kw">pooledVarsCaption</span>(<span class="dt">pv =</span> <span class="kw">pooledVarSpatial</span>(), <span class="dt">permit =</span> <span class="kw">permitPlot</span>(), 
        <span class="dt">ingrp =</span> input$groupSpatial))
})</code></pre>
<p>The data table outputs below are displayed in the app main panel area after a user has completed data selection, but prior to plotting. Once a plot is displayed on the screen, the data table is bumped down to remain below the plot.</p>
<p>Note that the data table displayed to the screen for the variability plots is the same as that shown for time series. This is because they use the same source data, but conditional tab panel reactivity I have built into the app requires that they be defined by their own reactive outputs.</p>
<p>Also worth noting is that these tables are built from GCM data only. The user option to overlay CRU data on GCM data in a plot is a plot option, not a data selection option. As a result, tables are already compiled before CRU is considered. Realistically, the tables are not worth literally reading in the browser, so it is not a big deal that CRU data, when selected under plot options. are not included in the tables. Displaying the tables best serves the purpose of letting the user know something has not gone clearly wrong with their intended data selection and subsetting, so that they may have confidence that their plot shows what they think it shows. The data download option will mirror this absence of selected CRU data in the table.</p>
</div>
<div id="time-series-data-table" class="section level4">
<h4>Time series data table</h4>
<pre class="sourceCode r"><code class="sourceCode r">output$SubsetTableTS &lt;-<span class="st"> </span><span class="kw">renderDataTable</span>({
    if (!<span class="kw">is.null</span>(<span class="kw">dat</span>())) 
        <span class="kw">dat</span>()[-<span class="kw">which</span>(<span class="kw">names</span>(<span class="kw">dat</span>()) %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Decade&quot;</span>))]
}, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">orderClasses =</span> <span class="ot">TRUE</span>, <span class="dt">lengthMenu =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>), <span class="dt">pageLength =</span> <span class="dv">5</span>))

output$TableTS &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">goBtnNullOrZero</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(if (<span class="kw">permitPlot</span>()) 
        <span class="kw">fluidRow</span>(<span class="kw">column</span>(<span class="dv">12</span>, <span class="kw">dataTableOutput</span>(<span class="st">&quot;SubsetTableTS&quot;</span>))))
})</code></pre>
</div>
<div id="scatter-plot-data-table" class="section level4">
<h4>Scatter plot data table</h4>
<pre class="sourceCode r"><code class="sourceCode r">output$SubsetTableScatter &lt;-<span class="st"> </span><span class="kw">renderDataTable</span>({
    if (!<span class="kw">is.null</span>(<span class="kw">dat2</span>())) 
        <span class="kw">dat2</span>()[-<span class="kw">which</span>(<span class="kw">names</span>(<span class="kw">dat2</span>()) %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Decade&quot;</span>))]
}, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">orderClasses =</span> <span class="ot">TRUE</span>, <span class="dt">lengthMenu =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>), <span class="dt">pageLength =</span> <span class="dv">5</span>))

output$TableScatter &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">goBtnNullOrZero</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(if (<span class="kw">permitPlot</span>()) 
        <span class="kw">fluidRow</span>(<span class="kw">column</span>(<span class="dv">12</span>, <span class="kw">dataTableOutput</span>(<span class="st">&quot;SubsetTableScatter&quot;</span>))))
})</code></pre>
</div>
<div id="heat-map-data-table" class="section level4">
<h4>Heat map data table</h4>
<pre class="sourceCode r"><code class="sourceCode r">output$SubsetTableHeatmap &lt;-<span class="st"> </span><span class="kw">renderDataTable</span>({
    if (!<span class="kw">is.null</span>(<span class="kw">dat_heatmap</span>()) &amp;&amp;<span class="st"> </span><span class="kw">nrow</span>(<span class="kw">dat_heatmap</span>() &gt;<span class="st"> </span><span class="dv">0</span>)) {
        if (<span class="kw">ncol</span>(<span class="kw">dat_heatmap</span>()) &gt;=<span class="st"> </span><span class="dv">9</span>) 
            <span class="kw">dat_heatmap</span>()[-<span class="dv">9</span>] else <span class="kw">dat_heatmap</span>()
    }
}, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">orderClasses =</span> <span class="ot">TRUE</span>, <span class="dt">lengthMenu =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>), <span class="dt">pageLength =</span> <span class="dv">5</span>))

output$TableHeatmap &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">goBtnNullOrZero</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(if (<span class="kw">permitPlot</span>() &amp;<span class="st"> </span>!<span class="kw">is.null</span>(<span class="kw">dat_heatmap</span>())) 
        if (<span class="kw">nrow</span>(<span class="kw">dat_heatmap</span>() &gt;<span class="st"> </span><span class="dv">0</span>)) 
            <span class="kw">fluidRow</span>(<span class="kw">column</span>(<span class="dv">12</span>, <span class="kw">dataTableOutput</span>(<span class="st">&quot;SubsetTableHeatmap&quot;</span>))))
})</code></pre>
</div>
<div id="variability-plots-data-table" class="section level4">
<h4>Variability plots data table</h4>
<pre class="sourceCode r"><code class="sourceCode r">output$SubsetTableVariability &lt;-<span class="st"> </span><span class="kw">renderDataTable</span>({
    if (!<span class="kw">is.null</span>(<span class="kw">dat</span>())) 
        <span class="kw">dat</span>()[-<span class="kw">which</span>(<span class="kw">names</span>(<span class="kw">dat</span>()) %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Decade&quot;</span>))]
}, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">orderClasses =</span> <span class="ot">TRUE</span>, <span class="dt">lengthMenu =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>), <span class="dt">pageLength =</span> <span class="dv">5</span>))  <span class="co"># same as table 1</span>

output$TableVariability &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">goBtnNullOrZero</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(if (<span class="kw">permitPlot</span>()) 
        <span class="kw">fluidRow</span>(<span class="kw">column</span>(<span class="dv">12</span>, <span class="kw">dataTableOutput</span>(<span class="st">&quot;SubsetTableVariability&quot;</span>))))
})</code></pre>
</div>
<div id="distribution-plots-data-table" class="section level4">
<h4>Distribution plots data table</h4>
<pre class="sourceCode r"><code class="sourceCode r">output$SubsetTableSpatial &lt;-<span class="st"> </span><span class="kw">renderDataTable</span>({
    if (!<span class="kw">is.null</span>(<span class="kw">dat_spatial</span>())) 
        <span class="kw">dat_spatial</span>()[-<span class="kw">which</span>(<span class="kw">names</span>(<span class="kw">dat_spatial</span>()) %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Decade&quot;</span>))]
}, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">orderClasses =</span> <span class="ot">TRUE</span>, <span class="dt">lengthMenu =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>), <span class="dt">pageLength =</span> <span class="dv">5</span>))

output$TableSpatial &lt;-<span class="st"> </span><span class="kw">renderUI</span>({
    if (<span class="kw">goBtnNullOrZero</span>()) 
        <span class="kw">return</span>()
    <span class="kw">isolate</span>(if (<span class="kw">permitPlot</span>()) 
        <span class="kw">fluidRow</span>(<span class="kw">column</span>(<span class="dv">12</span>, <span class="kw">dataTableOutput</span>(<span class="st">&quot;SubsetTableSpatial&quot;</span>))))
})</code></pre>
</div>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
