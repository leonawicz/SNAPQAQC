<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>QAQC Shiny App Metadata Finalization</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
padding-top: 50px;
padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar) */
.section h2 {
padding-top: 55px;
margin-top: -55px;
}
.section h3 {
padding-top: 55px;
margin-top: -55px;
}
/* don't use link color in navbar */
.dropdown-menu>li>a {
color: black;
}
/* some padding for disqus */
#disqus_thread {
margin-top: 45px;
}
p {
  text-align: justify;
}
img.centered {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #2a211c; color: #bdae9d; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #2a211c; color: #bdae9d; border-right: 1px solid #bdae9d; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #bdae9d; background-color: #2a211c; }
code > span.kw { color: #43a8ed; font-weight: bold; }
code > span.dt { text-decoration: underline; }
code > span.dv { color: #44aa43; }
code > span.bn { color: #44aa43; }
code > span.fl { color: #44aa43; }
code > span.ch { color: #049b0a; }
code > span.st { color: #049b0a; }
code > span.co { color: #0066ff; font-style: italic; }
code > span.al { color: #ffff00; }
code > span.fu { color: #ff9358; font-weight: bold; }
code > span.er { font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SNAP Data QA/QC</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Overview</a></li>

          <li class="dropdown">
            <a href="climate" class="dropdown-toggle" data-toggle="dropdown">Climate <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="AR4_AR5_extract.html">Downscaled GCMs</a></li>
              <li><a href="CRU_extract.html">Downscaled CRU 3.x</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">GCM organization</li>
              <li><a href="stats_setup.html">Regions: stats</a></li>
              <li><a href="samples_setup.html">Regions: densities</a></li>
              <li><a href="cities_setup.html">Cities: stats</a></li>
              <li class="dropdown-header">CRU organization</li>
              <li><a href="stats_setup_CRU.html">Regions: stats</a></li>
              <li><a href="samples_setup_CRU.html">Regions: densities</a></li>
              <li><a href="cities_setup_CRU.html">Cities: stats</a></li>
            </ul>

          <li class="dropdown">
            <a href="fire-&-veg" class="dropdown-toggle" data-toggle="dropdown">Fire & Veg <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="alfStatsByRep_Rmpi.html">ALFRESCO: Rmpi</a></li>
              <li><a href="alfStatsByRep.html">ALFRESCO: functions</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Organization</li>
              <li><a href="getAlfStatsAndDensities.html">ALFRESCO: stats and densities</a></li>
            </ul>

          <li class="dropdown">
            <a href="app-docs" class="dropdown-toggle" data-toggle="dropdown">App docs <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="aboutapp.html">About</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Help documents</li>
              <li><a href="help01_start.html">Getting started</a></li>
              <li><a href="help02_data.html">Working with data</a></li>
              <li><a href="help03_plotOptions.html">Graphical options</a></li>
              <li><a href="help04_updating.html">Updating settings</a></li>
              <li><a href="help05_01_graphTS.html">Graphing: time series</a></li>
              <li><a href="help05_02_graphScatter.html">Graphing: scatter plots</a></li>
              <li><a href="help05_03_graphHeat.html">Graphing: heat maps</a></li>
              <li><a href="help05_04_graphVar.html">Graphing: variability</a></li>
              <li><a href="help05_05_graphSpatial.html">Graphing: distributions</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Prep R code</li>
              <li><a href="qaqc_app_metadata.html">QA/QC App Metadata</a></li>
            </ul>

          <li class="dropdown">
            <a href="app-code" class="dropdown-toggle" data-toggle="dropdown">App code <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">App R code</li>
              <li><a href="appcode_global.html">global.R</a></li>
              <li><a href="appcode_ui.html">ui.R</a></li>
              <li><a href="appcode_server.html">server.R</a></li>
              <li><a href="appcode_about.html">about.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_sidebar.html">sidebar.R</a></li>
              <li><a href="appcode_main.html">main.R</a></li>
              <li><a href="appcode_serverHead.html">serverHead.R</a></li>
              <li><a href="appcode_app.html">app.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_io_sidebar.html">io_sidebar.R</a></li>
              <li><a href="appcode_io_main.html">io_main.R</a></li>
              <li><a href="appcode_reactives.html">reactives.R</a></li>
              <li class="divider"></li>
              <li><a href="appcode_plot_ts.html">plot_ts.R</a></li>
              <li><a href="appcode_plot_scatter.html">plot_scatter.R</a></li>
              <li><a href="appcode_plot_heatmap.html">plot_heatmap.R</a></li>
              <li><a href="appcode_plot_variability.html">plot_variability.R</a></li>
              <li><a href="appcode_plot_spatial.html">plot_spatial.R</a></li>
            </ul>

          <li><a href="http://leonawicz.github.io">All Projects</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/SNAPQAQC">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>

<div id="header">
<h1 class="title">QAQC Shiny App Metadata Finalization</h1>
</div>


<p>The <code>qaqc_app_metadata.R</code> script loads the <code>meta.RData</code> metadata workspace file used by the <code>cmip3_cmip5</code> QAQC app. Final preparations of region and city data file path locations are completed. This new workspace is saved over the original.</p>
<p>This script current handles subsetting of city files as best it can, but ultimately time is needed to investigate why GCM and CRU 3.x extractions of the same set of cities (specific grid cells) are yielding different, overlapping sets of cities.</p>
<div id="r-code" class="section level2">
<h2>R code</h2>
<p>File path information for GCM and CRU 3.x files are finalized.</p>
<pre class="sourceCode r"><code class="sourceCode r">#### This is the final script run after all app data and metadata files are
#### compiled.  This is for final formatting related to regions and cities.

<span class="kw">load</span>(<span class="st">&quot;/workspace/UA/mfleonawicz/leonawicz/projects/SNAPQAQC/data/final/meta.RData&quot;</span>)

topDir &lt;-<span class="st"> &quot;/workspace/Shared/Users/mfleonawicz/qaqcAppData&quot;</span>

region.gcm.stats.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_GCM/stats&quot;</span>), 
    <span class="dt">full =</span> T)
region.gcm.stats.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.gcm.stats.path, list.files, <span class="dt">full =</span> T)
region.cru.stats.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_CRU32/stats&quot;</span>), 
    <span class="dt">full =</span> T)
region.cru.stats.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.cru.stats.path, list.files, <span class="dt">full =</span> T)

region.gcm.samples.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_GCM/samples&quot;</span>), 
    <span class="dt">full =</span> T)
region.gcm.samples.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.gcm.samples.path, list.files, <span class="dt">full =</span> T)
region.cru.samples.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_CRU32/samples&quot;</span>), 
    <span class="dt">full =</span> T)
region.cru.samples.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.cru.samples.path, list.files, <span class="dt">full =</span> T)
<span class="kw">names</span>(region.cru.stats.files) &lt;-<span class="st"> </span><span class="kw">names</span>(region.gcm.stats.files) &lt;-<span class="st"> </span><span class="kw">names</span>(region.cru.samples.files) &lt;-<span class="st"> </span><span class="kw">names</span>(region.gcm.samples.files) &lt;-<span class="st"> </span><span class="kw">basename</span>(region.gcm.stats.path)</code></pre>
<p>File path information for GCM and CRU 3.x cities, and associated metadata, are fortified as best as currently possible. See code comments for details regarding pending investigation of discrepancies between data sets.</p>
<pre class="sourceCode r"><code class="sourceCode r">city.gcm.files.path &lt;-<span class="st"> </span><span class="kw">file.path</span>(topDir, <span class="st">&quot;city_files_GCM&quot;</span>)
city.gcm.files.2km &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(city.gcm.files.path, <span class="st">&quot;akcan2km&quot;</span>), 
    <span class="dt">full =</span> T)
city.gcm.files.10min &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(city.gcm.files.path, <span class="st">&quot;world10min&quot;</span>), 
    <span class="dt">full =</span> T)
city.cru.files.path &lt;-<span class="st"> </span><span class="kw">file.path</span>(topDir, <span class="st">&quot;city_files_CRU32&quot;</span>)
city.cru.files.2km &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(city.cru.files.path, <span class="st">&quot;akcan2km&quot;</span>), 
    <span class="dt">full =</span> T)
city.cru.files.10min &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(city.cru.files.path, <span class="st">&quot;world10min&quot;</span>), 
    <span class="dt">full =</span> T)

<span class="co"># city names to appear in app menu use one group of cities from above, all</span>
<span class="co"># four sets are identical</span>
city.names &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;FSLASH&quot;</span>, <span class="st">&quot;/&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;PER&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;APOS&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&#39;&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;--&quot;</span>, 
    <span class="st">&quot;, &quot;</span>, <span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">basename</span>(city.gcm.files.10min), <span class="st">&quot;__&quot;</span>), <span class="st">&quot;[[&quot;</span>, <span class="dv">1</span>)))))

<span class="co"># subset cities metadata data frame to match final files, same for all sets</span>
cities.meta.file &lt;-<span class="st"> &quot;/workspace/UA/mfleonawicz/leonawicz/projects/SNAPQAQC/data/final/cities_meta.RData&quot;</span>
<span class="kw">load</span>(cities.meta.file)
cities.meta &lt;-<span class="st"> </span><span class="kw">subset</span>(cities.meta, Location %in%<span class="st"> </span>city.names)
<span class="kw">save</span>(cities.meta, <span class="dt">file =</span> cities.meta.file)  <span class="co"># okay to save over original file</span>
<span class="kw">rm</span>(cities.meta.file, topDir)</code></pre>
<p>The <code>meta.RData</code> workspace used by the master QAQC Shiny app is loaded and re-saved.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save.image</span>(<span class="kw">file.path</span>(<span class="st">&quot;/workspace/UA/mfleonawicz/leonawicz/projects/SNAPQAQC/data/final/meta.RData&quot;</span>))</code></pre>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
