<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>QAQC Shiny App Metadata Finalization</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">

/* padding for bootstrap navbar */
body {
  padding-top: 50px;
  padding-bottom: 40px;
}
@media (max-width: 979px) {
  body {
    padding-top: 0;
  }
}

/* offset scroll position for anchor links (for fixed navbar)  */
@media (min-width: 980px) {
  .section h2 {
    padding-top: 52px;
    margin-top: -52px;
  }
  .section h3 {
    padding-top: 52px;
    margin-top: -52px;
  }
}


/* don't use link color in navbar */
.dropdown-menu>li>a {
  color: black;
}

/* some padding for disqus */
#disqus_thread {
  margin-top: 45px;
}

</style>

<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #2a211c; color: #bdae9d; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #2a211c; color: #bdae9d; border-right: 1px solid #bdae9d; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #bdae9d; background-color: #2a211c; }
code > span.kw { color: #43a8ed; font-weight: bold; }
code > span.dt { text-decoration: underline; }
code > span.dv { color: #44aa43; }
code > span.bn { color: #44aa43; }
code > span.fl { color: #44aa43; }
code > span.ch { color: #049b0a; }
code > span.st { color: #049b0a; }
code > span.co { color: #0066ff; font-style: italic; }
code > span.al { color: #ffff00; }
code > span.fu { color: #ff9358; font-weight: bold; }
code > span.er { font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SNAP Data QAQC</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Overview</a></li>

          <li><a href="code_sankey.html">Code flow</a></li>

          <li class="dropdown">
            <a href="gcm-climate" class="dropdown-toggle" data-toggle="dropdown">GCM climate <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="AR4_AR5_extract.html">Downscaled GCMs</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Organization</li>
              <li><a href="stats_setup.html">Regions: stats</a></li>
              <li><a href="samples_setup.html">Regions: densities</a></li>
              <li><a href="cities_setup.html">Cities: stats</a></li>
            </ul>

          <li class="dropdown">
            <a href="cru-3.1-climate" class="dropdown-toggle" data-toggle="dropdown">CRU 3.1 climate <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="CRU_extract.html">Downscaled CRU 3.1</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Organization</li>
              <li><a href="stats_setup_CRU31.html">Regions: stats</a></li>
              <li><a href="samples_setup_CRU31.html">Regions: densities</a></li>
              <li><a href="cities_setup_CRU31.html">Cities: stats</a></li>
            </ul>

          <li class="dropdown">
            <a href="fire-&-vegetation" class="dropdown-toggle" data-toggle="dropdown">Fire & Vegetation <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Extraction</li>
              <li><a href="alfStatsByRep_Rmpi.html">ALFRESCO: Rmpi</a></li>
              <li><a href="alfStatsByRep.html">ALFRESCO: functions</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Organization</li>
              <li><a href="getAlfStatsAndDensities.html">ALFRESCO: stats and densities</a></li>
            </ul>

          <li class="dropdown">
            <a href="other-r-code" class="dropdown-toggle" data-toggle="dropdown">Other R Code <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="qaqc_app_metadata.html">QAQC App Metadata</a></li>
            </ul>

          <li><a href="http://leonawicz.github.io">All Projects</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/SNAPQAQC">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>

<div id="header">
<h1 class="title">QAQC Shiny App Metadata Finalization</h1>
</div>


<p>The <code>qaqc_app_metadata.R</code> script loads the <code>meta.RData</code> metadata workspace file used by the <code>cmip3_cmip5</code> QAQC app. Final preparations of region and city data file path locations are completed. This new workspace is saved over the original.</p>
<p>This script current handles subsetting of city files as best it can, but ultimately time is needed to investigate why GCM and CRU extractions of the same set of cities (specific grid cells) are yielding different, overlapping sets of cities.</p>
<div id="r-code" class="section level2">
<h2>R code</h2>
<p>File path information for GCM and CRU files are finalized.</p>
<pre class="sourceCode r"><code class="sourceCode r">#### This is the final script run after all app data and metadata files are
#### compiled.  This is for final formatting related to regions and cities.

topDir &lt;-<span class="st"> &quot;/workspace/Shared/Users/mfleonawicz/AR4_AR5_Comparisons&quot;</span>

region.gcm.stats.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_GCM/stats&quot;</span>), 
    <span class="dt">full =</span> T)
region.gcm.stats.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.gcm.stats.path, list.files, <span class="dt">full =</span> T)
region.cru.stats.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_CRU/stats&quot;</span>), 
    <span class="dt">full =</span> T)
region.cru.stats.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.cru.stats.path, list.files, <span class="dt">full =</span> T)

region.gcm.samples.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_GCM/samples&quot;</span>), 
    <span class="dt">full =</span> T)
region.gcm.samples.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.gcm.samples.path, list.files, <span class="dt">full =</span> T)
region.cru.samples.path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(topDir, <span class="st">&quot;region_files_CRU/samples&quot;</span>), 
    <span class="dt">full =</span> T)
region.cru.samples.files &lt;-<span class="st"> </span><span class="kw">lapply</span>(region.cru.samples.path, list.files, <span class="dt">full =</span> T)
<span class="kw">names</span>(region.cru.stats.files) &lt;-<span class="st"> </span><span class="kw">names</span>(region.gcm.stats.files) &lt;-<span class="st"> </span><span class="kw">names</span>(region.cru.samples.files) &lt;-<span class="st"> </span><span class="kw">names</span>(region.gcm.samples.files) &lt;-<span class="st"> </span><span class="kw">basename</span>(region.gcm.stats.path)</code></pre>
<p>File path information for GCM and CRU cities, and associated metadata, are fortified as best as currently possible. See code comments for details regarding pending investigation of discrepancies between data sets.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># City inclusion is not perfect, some cities are dropped out CRU has fewer</span>
<span class="co"># city files, no time to investigate yet</span>
city.cru.files.path &lt;-<span class="st"> </span><span class="kw">file.path</span>(topDir, <span class="st">&quot;city_files_CRU&quot;</span>)
city.cru.files &lt;-<span class="st"> </span><span class="kw">list.files</span>(city.cru.files.path, <span class="dt">full =</span> T)

city.gcm.files.path &lt;-<span class="st"> </span><span class="kw">file.path</span>(topDir, <span class="st">&quot;city_files_GCM&quot;</span>)
<span class="co"># restrict GCM files to subset with corresponding CRU files</span>
city.gcm.files &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;city_files_CRU&quot;</span>, <span class="st">&quot;city_files_GCM&quot;</span>, city.cru.files)  <span class="co"># list.files(city.gcm.files.path, full=T)</span>

<span class="co"># city names to appear in app menu</span>
city.names &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;APOS&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&#39;&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;--&quot;</span>, <span class="st">&quot;, &quot;</span>, <span class="kw">sapply</span>(<span class="kw">strsplit</span>(<span class="kw">basename</span>(city.gcm.files), 
    <span class="st">&quot;__&quot;</span>), <span class="st">&quot;[[&quot;</span>, <span class="dv">1</span>)))

<span class="co"># subset cities metadata data frame to match CRU files</span>
cities.meta.file &lt;-<span class="st"> &quot;/workspace/UA/mfleonawicz/leonawicz/projects/AR4_AR5_comparisons/data/final/cities_meta_akcan2km.RData&quot;</span>
<span class="kw">load</span>(cities.meta.file)
cities.meta.akcan2km &lt;-<span class="st"> </span><span class="kw">subset</span>(cities.meta.akcan2km, Location %in%<span class="st"> </span>city.names)
<span class="kw">save</span>(cities.meta.akcan2km, <span class="dt">file =</span> cities.meta.file)  <span class="co"># okay to save over original file</span>
<span class="kw">rm</span>(cities.meta.file, topDir)

<span class="co"># reverse for consistency, extra precaution</span>
city.names &lt;-<span class="st"> </span>city.names[city.names %in%<span class="st"> </span>cities.meta.akcan2km$Location]</code></pre>
<p>The <code>meta.RData</code> workspace used by the master QAQC Shiny app is loaded and re-saved.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;/workspace/UA/mfleonawicz/leonawicz/projects/AR4_AR5_comparisons/data/final/meta.RData&quot;</span>)
<span class="kw">save.image</span>(<span class="kw">file.path</span>(<span class="st">&quot;/workspace/UA/mfleonawicz/leonawicz/projects/AR4_AR5_comparisons/data/final/meta.RData&quot;</span>))</code></pre>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
